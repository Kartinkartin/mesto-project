(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{d:()=>D});var t=document.querySelector(".page"),n=document.querySelector(".popup.picture"),o=n.querySelector(".popup__picture-description"),r=n.querySelector(".popup__picture");function c(e){var t=e.querySelector(".form-popup__button");if(e.classList.contains("popup_opened"))return t.setAttribute("disabled","disabled"),t.textContent="Сохранение...",void t.classList.add("form-popup__button_inactive");t.classList.remove("form-popup__button_inactive"),t.textContent="Сохранить",t.removeAttribute("disabled","disabled")}function a(e){e.classList.add("popup_opened"),t.addEventListener("keydown",i)}function u(e){t.removeEventListener("keydown",i),e.classList.remove("popup_opened")}function i(e){if("Escape"===e.key){var n=t.querySelector(".popup_opened");n&&u(n)}}var s={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"48b44853-052f-4cb6-9199-05fafd5281f2","Content-Type":"application/json"}},l=document.querySelector("#card-element").content,d=document.querySelector(".cards__list"),p=document.querySelector(".popup.place"),f=p.querySelector("fieldset.form-popup__input input[name=new-place-name]"),m=p.querySelector("fieldset.form-popup__input input[name=new-place-link]");function _(e){var t,c,u=l.querySelector(".cards__item").cloneNode(!0),i=u.querySelector(".cards__image"),d=u.querySelector(".cards__button-like"),p=u.querySelector(".cards__likes-counter");return D.id==e.owner._id&&u.append((t=e._id,(c=document.createElement("button")).classList.add("cards__button-delete"),c.addEventListener("click",(function(){(function(e){return fetch("".concat(s.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))})(t).then(c.closest("li").remove())})),c)),e.likes.length&&(p.textContent=e.likes.length),e.likes.some((function(e){return e._id==D.id}))&&d.classList.add("cards__button-like_active"),i.src=e.link,i.alt=e.name,u.querySelector(".cards__title").textContent=e.name,i.addEventListener("click",(function(){var t,c;t=e.name,c=e.link,o.textContent=t,r.setAttribute("src","".concat(c)),r.setAttribute("alt","".concat(t)),a(n)})),d.addEventListener("click",(function(){var t;d.classList.contains("cards__button-like_active")?d.classList.contains("cards__button-like_active")&&function(e){return fetch("".concat(s.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}(e._id).then((function(e){return d.classList.remove("cards__button-like_active"),p.textContent=e.likes.length})):(t=e._id,fetch("".concat(s.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){return d.classList.add("cards__button-like_active"),p.textContent=e.likes.length}))})),u}var v=document.querySelector(".page");function h(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.buttonDisabledClass),t.removeAttribute("disabled")):(t.setAttribute("disabled","disabled"),t.classList.add(n.buttonDisabledClass))}var b,y=document.querySelectorAll(".popup"),S=document.querySelector(".profile__name"),q=document.querySelector(".profile__role"),k=document.querySelector(".profile__photo"),L=document.querySelector(".profile__photo.profile__photo-shield"),E=document.querySelector(".popup.profile"),C=E.querySelector("fieldset.form-popup__input input[name=name]"),g=E.querySelector("fieldset.form-popup__input input[name=role]"),j=document.querySelector(".popup.avatar"),x=j.querySelector("fieldset.form-popup__input input[name=avatar-link]"),A=document.querySelector(".profile__button-edit"),P=document.querySelector(".profile__button-plus"),U=document.querySelector(".popup.place"),D={};fetch("".concat(s.baseUrl,"/users/me"),{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return{name:"",about:e}})).then((function(e){S.textContent=e.name,q.textContent=e.about,k.alt=e.name,k.src="".concat(e.avatar),D.id=e._id})),A.addEventListener("click",(function(){C.value=S.textContent,g.value=q.textContent,a(E)})),E.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=C.value,r=g.value;c(E),(t=o,n=r,fetch("".concat(s.baseUrl,"/users/me"),{method:"PATCH",headers:s.headers,body:JSON.stringify({name:t,about:n},["name","about"])}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){return S.textContent=e.name,q.textContent=e.about,u(E),Promise.resolve(1e3)})).then((function(e){setTimeout((function(){c(E)}),e)}))})),L.addEventListener("click",(function(){a(j)})),j.addEventListener("submit",(function(e){var t;e.preventDefault(),c(j),(t=x.value,fetch("".concat(s.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:t},["avatar"])}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then(k.src=x.value).then((function(){return u(j),Promise.resolve(1e3)})).then((function(e){setTimeout((function(){c(j)}),e)}))})),y.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&u(e),t.target.classList.contains("popup__button-close")&&u(e)}))})),fetch("".concat(s.baseUrl,"/cards"),{headers:s.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){!function(e,t){d.append(_(e))}(e)}))})).catch((function(e){document.querySelector(".cards").textContent=e})),P.addEventListener("click",(function(){a(U)})),U.addEventListener("submit",(function(e){e.preventDefault();var t,n,o,r=f.value,c=m.value,a=e.target.querySelector(".form-popup__button");a(p),(n=r,o=c,fetch("".concat(s.baseUrl,"/cards"),{method:"POST",headers:s.headers,body:JSON.stringify({name:n,link:o},["name","link"])}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((t=r,void d.prepend(_(t)))),u(p),e.target.reset(),a.setAttribute("disabled","disabled"),a.classList.add("form-popup__button_inactive"),a.textContent="Сохранить"})),b={form:".form-popup",fieldset:".form-popup__input",input:".form-popup__item",button:".form-popup__button",buttonDisabledClass:"form-popup__button_inactive",inputErrorClass:"form-popup__item_type_error",errorMessageClass:"form-popup__item-error_active"},Array.from(v.querySelectorAll(b.form)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(b.fieldset)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.input)),o=e.querySelector(t.button);h(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid||function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorMessageClass)}(e,t,t.validationMessage,n),t.validity.valid&&function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorMessageClass),o.textContent=""}(e,t,n)}(e,r,t),h(n,o,t)}))}))}(e,b)}))}))})();